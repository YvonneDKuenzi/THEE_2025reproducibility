---
title: "Biomass data merging"
output: html_document
date: "2026-01-29"
---

Legende codes column "no_brutto"
Abk.	Bedeutung
A	Brutto fehlt; Gesamttrocken = Kl. Probe trocken
B	Brutto fehlt; ohne Box gewogen, Gesamttrocken ≠ Kl. Probe trocken
R	ganze Probe entnommen; Gesamtgewicht im Vergleich zur Hochrechnung aus kl. Probe

```{r}
#setwd("~/R files/Lüdiweid")#from ips
setwd("C:/Users/yvonn/Desktop/Working directory R home office/Liechti_mix_publication")#from home
library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)
library(stringr)

#read in single biomass data files
bio4765 <- read_excel("Data/Biomasse einzeln/Biomasse Lüdiweide 47-65 kombiniert.xlsx")
bio33 <- read_excel("Data/Biomasse einzeln/1933.xlsx")
bio34 <- read_excel("Data/Biomasse einzeln/1934.xlsx")
bio35 <- read_excel("Data/Biomasse einzeln/1935.xlsx")
bio36 <- read_excel("Data/Biomasse einzeln/1936.xlsx")
bio37 <- read_excel("Data/Biomasse einzeln/1937.xlsx")
bio38 <- read_excel("Data/Biomasse einzeln/1938.xlsx")
bio39 <- read_excel("Data/Biomasse einzeln/1939.xlsx")
bio40 <- read_excel("Data/Biomasse einzeln/1940.xlsx")
bio41 <- read_excel("Data/Biomasse einzeln/1941.xlsx")
bio42 <- read_excel("Data/Biomasse einzeln/1942.xlsx")
bio43 <- read_excel("Data/Biomasse einzeln/1943.xlsx")
bio44 <- read_excel("Data/Biomasse einzeln/1944.xlsx")
bio45 <- read_excel("Data/Biomasse einzeln/1945.xlsx")
bio46 <- read_excel("Data/Biomasse einzeln/1946.xlsx")
bio53 <- read_excel("Data/Biomasse einzeln/1953.xlsx")

#combine bio33 to bio53

bio3353 <- rbind(bio33,bio34,bio35,bio36,bio37,bio38,bio39,bio40,bio41,bio42,bio43,bio44,bio45,bio46,bio53)
View(bio3353)

#rename to match headers in bio4765
bio3353ren <-  bio3353 %>% 
  rename(plot = "Plot-ID",
         year = Year,
         biomass = `Gesamt trocken`,
         no_brutto = `Brutto fehlt`,
         comment = Bemerkung
         )

#select only rows (plots per year) with biomass data
bio3353clean <- filter(bio3353ren, biomass != "NA")
View(bio3353clean)
str(bio3353clean)
bio3353clean$biomass <- as.numeric(bio3353clean$biomass)

bio3353clean <- mutate_at(bio3353clean, c("plot", "year"), as.factor)

# skip column "cont.harvest" from bio4765
bio4765clean<- bio4765[ ,-5]
str(bio4765clean)
bio4765clean <- mutate_at(bio4765clean, c("plot", "year"), as.factor)

#combine both biomass files

bio.all <- rbind(bio3353clean,bio4765clean)

aggregate(plot ~ year, data = bio.all, FUN = length)

bio.all53 <- filter(bio.all, year=="1953")#check if plots are twice in df in 53, because two sheets for this year

#View(bio.all53) # plot 287 in year 1953 is twice in data (with identical biomass)

#View(bio.all)# duplicated rows are: 4217 & 5789

bio.all <- bio.all[-5789,] #delete one of the duplicates
```

